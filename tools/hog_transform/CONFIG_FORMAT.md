# HOG Configuration File Format

The `*_hogcfg.json` files generated by `hog_processor` use string-based enums that are synchronized between the PC tool and ESP32 MCU library, ensuring consistency and readability.

## ESP32 Configuration Section

```json
"esp32": {
  "input_format": "GRAYSCALE",
  "input_width": 320,
  "input_height": 240,
  "resize_method": "BILINEAR",
  "maintain_aspect_ratio": false,
  "jpeg_quality": 80
}
```

### `input_format` (ImageProcessing::PixelFormat)

String values that map to `ImageProcessing::PixelFormat` enum:

- `"GRAYSCALE"` - 8-bit grayscale (recommended for HOG)
- `"RGB565"` - 16-bit RGB565 format
- `"RGB888"` - 24-bit RGB888 format
- `"YUV422"` - YUV422 format
- `"JPEG"` - JPEG compressed

**Recommendation:** Use `"GRAYSCALE"` for fastest processing and lowest memory usage.

### `resize_method` (ImageProcessing::ResizeMethod)

String values that map to `ImageProcessing::ResizeMethod` enum:

- `"NEAREST_NEIGHBOR"` or `"NEAREST"` - Fastest, lower quality
- `"BILINEAR"` - Good balance (recommended)
- `"AREA_AVERAGE"` or `"AREA"` - Best quality for downsampling, slower

**Recommendation:** Use `"BILINEAR"` for good quality and reasonable speed.

### `input_width` and `input_height`

Camera capture resolution in pixels. Common ESP32-CAM resolutions:

- 160x120 (QQVGA) - Very fast
- 320x240 (QVGA) - Recommended default
- 640x480 (VGA) - Higher quality
- 800x600 (SVGA) - High quality, slower

**Recommendation:** Use 320x240 for good balance between quality and speed.

### `maintain_aspect_ratio`

- `true` - Preserve aspect ratio during resize (may add padding)
- `false` - Stretch to fit target dimensions (recommended for HOG)

### `jpeg_quality`

JPEG compression quality (0-100). Only used if `input_format` is 4 (JPEG).

- Higher values = better quality, larger files
- Range: 10-63 for ESP32 camera

## HOG Configuration Section

```json
"hog": {
  "hog_img_width": 32,
  "hog_img_height": 32,
  "cell_size": 8,
  "block_size": 16,
  "block_stride": 6,
  "nbins": 4
}
```

### Parameters

- `hog_img_width`, `hog_img_height`: Size of image after resizing for HOG processing
- `cell_size`: Size of each HOG cell in pixels (typically 6-8)
- `block_size`: Size of each block in pixels (typically 2x cell_size)
- `block_stride`: Overlap between blocks in pixels
- `nbins`: Number of orientation histogram bins (typically 4-9)

### Feature Count Calculation

```
blocks_x = (hog_img_width - block_size) / block_stride + 1
blocks_y = (hog_img_height - block_size) / block_stride + 1
cells_per_block = 4  # (2x2 cells)
features = blocks_x * blocks_y * cells_per_block * nbins
```

**Example:** 32x32 image with default parameters:
- blocks_x = (32-16)/6+1 = 3
- blocks_y = (32-16)/6+1 = 3
- features = 3 * 3 * 4 * 4 = 144 features

## Why String Enums?

Using string enum names instead of magic numbers:

1. **Readable** - Config files are self-documenting (e.g., "GRAYSCALE" vs 0)
2. **Maintainable** - Easy to understand what each value means
3. **Synchronized** - Same names used in PC tool and MCU library
4. **Flexible** - Parser handles variations (e.g., "NEAREST" or "NEAREST_NEIGHBOR")
5. **Safe** - Invalid values default to sensible fallbacks

The parser on ESP32 converts these strings to the appropriate enum values automatically.

## Usage in Arduino Sketch

The HOG_MCU library automatically loads and applies the configuration:

```cpp
#include "hog_transform.h"
#include "Rf_file_manager.h"

HOG_MCU hog;

void setup() {
    // Choose storage: SD_MMC, SD_SPI, or LITTLEFS
    const RfStorageType STORAGE_MODE = RfStorageType::SD_MMC;
    RF_FS_BEGIN(STORAGE_MODE);  // Mount filesystem with selected storage
    
    // Load config - parser converts strings to enums automatically!
    if (hog.loadConfigFromFile("/digit/digit_hogcfg.json")) {
        // Config applied automatically
        // "GRAYSCALE" → ImageProcessing::PixelFormat::GRAYSCALE
        // "BILINEAR" → ImageProcessing::ResizeMethod::BILINEAR
    }
}
```

## Generating Config Files

Use the `hog_processor` tool to generate properly formatted config files:

```bash
cd tools/hog_transform
./hog_processor hog_config.json
```

This creates:
- `model_name.csv` - Training dataset with HOG features
- `model_name_hogcfg.json` - ESP32 configuration (integer enums)
