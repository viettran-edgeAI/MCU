/*
 * Walker Fall Detection Example
 * 
 * This example demonstrates real-time activity classification using a Random Forest
 * model trained to detect different human activities (idle, walking, motion, falling).
 * 
 * Features:
 * - Loads pre-trained Random Forest model from filesystem
 * - Performs predictions on 8 sample feature vectors (234 features each)
 * - Compares predictions against ground truth labels
 * - Calculates accuracy and timing metrics
 * - Supports actual label feedback for continuous learning
 * 
 * Hardware: ESP32 or compatible microcontroller with LittleFS support
 * Dataset: Walker fall detection with accelerometer/gyroscope features
 */

#define EML_DEV_STAGE    
#define RF_DEBUG_LEVEL 2
#define RF_USE_PSRAM

#include "random_forest_mcu.h"

const RfStorageType STORAGE_MODE = RfStorageType::SD_MMC_1BIT;

using namespace mcu;

void setup() {
    Serial.begin(115200);  
    while (!Serial);       // <-- Waits for Serial monitor to connect (important for USB CDC)

    Serial.println("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    Serial.println("â•‘  Walker Fall Detection - Random Forest Example    â•‘");
    Serial.println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    
    delay(1000);

    // Initialize filesystem
    Serial.print("ðŸ’¾ Initializing file system... ");
    if (!RF_FS_BEGIN(STORAGE_MODE)) {
        Serial.println("âŒ FAILED!");
        Serial.println("âš ï¸  File system initialization failed. Cannot continue.");
        return;
    }
    Serial.println("âœ… OK");
    
    manage_files();
    delay(500);
    
    long unsigned start_forest = mcu::platform::Rf_get_current_time(mcu::platform::TimeUnit::MILLISECONDS);
    
    // Initialize Random Forest model
    Serial.print("Loading model 'walker_fall'... ");
    const char* model_name = "walker_fall"; 
    RandomForest forest = RandomForest(model_name);
    
    // Optional: Configure forest parameters before training
    // forest.set_num_trees(20);
    // forest.set_random_seed(42);
    // forest.set_training_score(Rf_training_score::OOB_SCORE); 
    
    // Optional: Train or build model (commented out for pre-trained model)
    forest.build_model();
    long unsigned build_time = mcu::platform::Rf_get_current_time(mcu::platform::TimeUnit::MILLISECONDS);
    Serial.printf("Model built in %lu ms\n", build_time - start_forest);

    // forest.training(3);
    
    // Load pre-trained forest from filesystem
    long unsigned load_start = mcu::platform::Rf_get_current_time(mcu::platform::TimeUnit::MILLISECONDS);
    if (!forest.loadForest()) {
        Serial.println("âŒ FAILED");
        return;
    }
    long unsigned load_end = mcu::platform::Rf_get_current_time(mcu::platform::TimeUnit::MILLISECONDS);
    Serial.printf("Forest loaded in %lu ms\n", load_end - load_start);

    // Optional: Enable dataset extension for online learning
    // forest.enable_extend_base_data();

    // simulate prediction in real-world 
    b_vector<float> sample_1 = MAKE_FLOAT_LIST(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,1.7828,1.8374,1.9411,1.95,2.0495,1.7633,2.0399,1.793,1.7403,1.77,1.9222,1.7136,1.7365,1.5907,1.8233,1.7592,1.71,1.739,1.8873,1.851,1.83,1.6658,1.8259,1.7581,1.7418,1.8637,1.89,1.7284,1.834,1.8523,1.9326,1.8573,1.8293,1.8115,1.7924,1.71,1.7454,1.77,1.8204,1.887,1.89,1.7935,1.77,1.89,1.89,1.89,1.89,1.77,1.77,1.8496,1.9396,1.7606,1.7432,1.801,1.815,1.8166,1.7957,1.847,1.89,1.8877,1.7528,1.7191,1.708,1.6662,1.83,1.779,1.7191,1.8134,1.9357,1.6928,1.83,1.7,1.7851,1.8818,1.8307,1.782,1.6781,1.65,1.702,1.676,1.7812,1.83,1.83,1.7829,1.8722,1.7827,1.7346,1.9934,1.865,1.83,1.7203,1.8054,1.77,1.77,1.7255,1.8273,1.8098,1.77,1.9185,1.8893,1.6718,1.7335,1.77,1.8109,1.912,1.83,1.83,1.8082,1.8123,1.8575,1.8799,1.8583,1.9184,1.8037,1.9688,1.8712,1.77,1.77,1.8856,1.8044,1.8405,1.9408,1.6829,1.7504,1.8791,1.8012,1.8447,1.8118,1.8726,1.8354,1.595,1.6654,1.7877,1.8448,1.7862,1.77,1.77,1.832,1.8692,1.857,1.7008,1.8091,1.9423,1.871,1.7886,1.89,1.89,1.7567,1.7186,1.9088,1.956,1.9369,1.7802,1.6552,1.8255,1.7909,1.6743,1.8241,1.8558,1.9348,0.9928,0.92,0.7071,0.8197,0.8389,0.9095,0.85,0.8716,0.8847,0.9525,0.98,0.9189,0.987,0.7904,0.94,1.0784,0.9675,0.8819,0.8559,0.9344,1.0252,0.92,1.027,0.8638,0.9835,1.1805,1.1634,1.0816,0.948,1.0211,1.04,1.0091,0.9157,0.8805,0.92,0.8327,0.8254,0.9513,0.9296,0.977,0.9279,0.85,0.85,0.98,0.9263,0.85,0.85,0.861,0.7967,0.85,0.85,0.9597,0.8168,0.8571,0.9025,0.9509,0.98,0.9415,0.92,0.9408,0.98,0.98,1.036,0.9308,1.0732,0.998,0.8697,0.8802,0.9158,0.9485,1.04,0.9584,1.0376,0.9964,0.7328,0.892,0.85,0.9817,1.04,0.9713,0.9363,1.052,1.1,1.0336,0.9519,0.8101,0.9446,0.9242,0.8383,0.9056,1.0348,0.9268,0.9003,1.0707,0.9955,1.0973,0.9402,0.9493,1.0685,0.932,0.79,0.8318,0.7921,0.8787,0.961,0.8883,0.9932,1.0182,1.0223,1.0125,0.98,1.0083,0.9217,0.8212,0.9536,0.9787,0.8831,0.796,1.1422,1.0316,0.9291,0.85,0.85,0.9225,1.0291,0.92,0.8936,0.9406,1.04,1.04,0.99,1.1307,1.0311,1.0026,0.9281,0.92,0.92,0.734,0.8084,0.8885,0.9539,1.0261,1.1523,1.081,0.9986,0.92,0.92,1.0066,1.0828,1.0212,1.007,0.9556,0.9006,0.852,1.0309,0.9619,1.0043,1.1,1.1,0.92,1.46,1.46,1.5196,1.4219,1.5549,1.4378,1.53,1.5084,1.4297,1.4,1.5099,1.4282,1.46,1.4602,1.5155,1.4108,1.46,1.431,1.5927,1.629,1.5595,1.46,1.5941,1.6381,1.5212,1.46,1.46,1.5167,1.428,1.3777,1.3826,1.467,1.5597,1.5071,1.4595,1.5646,1.5793,1.4287,1.5092,1.53,1.53,1.4255,1.5764,1.4836,1.5548,1.5065,1.4093,1.6314,1.59,1.5502,1.53,1.4506,1.5051,1.59,1.59,1.59,1.59,1.59,1.533,1.5692,1.53,1.53,1.53,1.53,1.53,1.53,1.4197,1.4819,1.5786,1.53,1.476,1.46,1.5125,1.6336,1.5313,1.53,1.5619,1.59,1.538,1.5112,1.4352,1.618,1.4647,1.46,1.46,1.46,1.5132,1.6458,1.53,1.4744,1.59,1.5654,1.4365,1.4502,1.59,1.59,1.4,1.4664,1.5795,1.53,1.4473,1.4905,1.5879,1.5491,1.4822,1.5572,1.5613,1.46,1.4177,1.4872,1.5681,1.5214,1.59,1.5612,1.5651,1.53,1.417,1.4572,1.4696,1.5099,1.53,1.5318,1.5834,1.5175,1.4109,1.4642,1.4226,1.46,1.5726,1.5354,1.6475,1.6123,1.4089,1.4374,1.6243,1.5201,1.4688,1.4623,1.5057,1.6289,1.6239,1.6961,1.5778,1.465,1.5311,1.6688,1.7019,1.5433,1.5814,1.6912,1.644,1.6856,1.5975,1.4654,1.53,1.53,1.59,1.5629,1.4559,1.4666);
    b_vector<float> sample_2 = MAKE_FLOAT_LIST(-0.0008,0.0181,0.1298,0.1815,0.1867,0.0526,0.0188,0.0228,0.3152,0.3559,0.3647,0.4213,0.4188,0.3888,0.3637,0.3224,0.3381,0.3207,0.3661,0.0648,0.31,0.0898,0.1397,0.0717,0.0467,0.0723,0.0797,0.0731,0.092,0.0722,0.0489,0.0544,0.026,0.0094,0.0587,0.0228,0.0515,0.0248,0.0335,0.04,0.0163,0.0122,-0.0051,0.011,0.0297,0.0119,-0.007,-0.0055,-0.0148,0.0213,0.0147,-0.0199,0.0043,-0.0345,-0.0381,-0.0179,0.0724,-0.0547,-0.0476,-0.0414,-0.1003,-0.036,-0.0125,-0.1081,-0.0829,-0.0567,-0.0848,-0.0756,-0.0662,0.0004,0.0119,-0.0443,-0.1457,-0.0321,0.2459,0.0467,0.0245,-0.0322,0.7073,0.047,-0.0045,0.0286,0.0969,0.0441,0.2032,0.1118,-0.0329,0.0157,0.06,-0.0293,0.0315,0.1653,0.2161,-0.0189,-0.0234,-0.0151,-0.0424,0.1009,0.0678,0.6316,0.0591,0.0906,0.0509,0.0123,-0.0017,0.0084,0.007,0.0588,-0.0323,0.0136,0.0076,0.0297,0.0469,0.1829,0.0388,0.1673,0.1224,0.0293,-0.0341,-0.062,-0.0525,-0.0175,-0.0547,-0.0659,-0.0374,-0.0015,-0.0197,0.1485,0.0662,0.0376,0.0305,0.6215,-0.0389,-0.0216,0.0208,0.0342,-0.0071,0.0928,-0.008,0.0198,-0.0334,0.2862,0.0633,-0.0031,0.0137,0.3178,-0.0281,-0.019,-0.0514,0.033,0.0191,0.0128,0.044,0.0256,0.042,0.0216,0.0327,0.0227,0.1621,0.0545,1.152,1.174,1.1844,1.1904,1.2068,1.204,1.1644,1.2163,1.1352,1.3351,1.358,1.1329,1.3142,1.1753,0.864,0.8296,0.8063,0.7952,0.7618,0.6983,0.7095,0.7348,0.7378,0.75,0.7157,0.7037,0.6352,0.6417,0.6317,0.6257,0.5844,0.5842,0.5626,0.5638,0.5836,0.5162,0.4703,0.4932,0.4551,0.432,0.4056,0.3723,0.3703,0.3313,0.3512,0.3036,0.2657,0.2948,0.255,0.22,0.2122,0.2004,0.1837,0.1291,0.2408,0.1195,0.2418,0.0517,0.6065,0.1456,-0.0313,0.482,0.1451,0.6451,0.165,0.5791,0.0382,0.0434,0.1329,0.1399,-0.0186,0.1311,-0.0038,0.0136,0.0534,0.0162,-0.0321,0.0002,-0.0508,-0.0696,-0.0172,-0.0782,-0.0518,-0.1074,-0.1444,-0.1142,-0.1462,0.1424,-0.1741,-0.1815,-0.1526,-0.1856,-0.1363,-0.2104,-0.2153,-0.2075,-0.1206,-0.1629,-0.1716,-0.0801,-0.0457,-0.0705,-0.0227,0.0054,-0.0152,-0.0549,-0.0447,0.504,-0.0483,-0.0357,-0.0167,-0.1114,-0.0885,-0.0568,-0.0964,-0.0942,-0.0802,-0.1241,-0.1409,-0.1239,-0.0561,0.0275,-0.0311,-0.0073,0.0058,-0.006,0.0161,-0.1271,-0.0358,-0.052,-0.1007,-0.0734,-0.0581,-0.0836,-0.1188,0.3044,-0.101,-0.0138,0.1909,0.205,0.6027,0.0879,-0.0649,0.1004,-0.0497,-0.0863,-0.0718,-0.0665,-0.0243,0.0222,-0.0026,-0.0443,-0.0116,0.0129,-0.0089,-0.0342,-0.0294,-0.0405,-0.0342,-0.0491,0.1469,0.1642,0.1605,0.1806,0.1808,0.196,0.1939,0.1973,0.2438,0.263,0.2645,0.2996,0.2812,0.3839,0.2696,0.2825,0.2466,0.2409,0.2271,0.1841,0.1431,0.1236,0.0909,0.1358,0.0438,0.0062,-0.0216,-0.021,-0.0191,-0.0176,-0.0279,0,0.0025,-0.0162,-0.0224,-0.0416,0.0567,-0.0239,-0.001,-0.0088,-0.054,-0.0198,-0.0456,-0.039,-0.091,-0.0849,-0.0807,-0.0691,-0.1182,-0.0688,-0.1289,-0.1154,-0.1131,-0.0087,-0.1288,-0.1256,-0.0161,0.196,0.6324,0.1096,-0.1572,0.6956,-0.035,0.7814,0.0145,0.2602,-0.0093,-0.0387,-0.0763,0.1807,0.001,0.3349,-0.1016,-0.0438,0.0356,0.0533,-0.0561,0.1241,0.0009,-0.0869,0.2139,0.2234,-0.1633,0.6105,-0.1319,-0.062,0.0117,-0.0841,-0.1341,-0.1885,0.3429,0.0297,-0.1712,0.0479,-0.2194,-0.0338,-0.0553,-0.2927,0.6835,-0.0196,0.3773,0.083,-0.0805,0.5064,0.1169,0.1232,-0.1357,0.3644,-0.1991,-0.1776,-0.0892,-0.203,0.2597,0.0186,0.3051,-0.1102,-0.1885,-0.1318,0.2174,0.1445,0.3881,0.4301,0.2083,0.3617,0.2252,0.315,0.1163,0.3371,-0.1338,-0.291,0.1837,0.0844,0.2287,-0.0356,0.4163,0.455,-0.1078,0.5248,0.2094,-0.3619,0.1366,-0.155,0.1412,0.2445,-0.1036,-0.1287,-0.2785,-0.2597,-0.1983,-0.3745,-0.1772,-0.3089,-0.215,-0.1013,-0.246,-0.2486,-0.2933,-0.2251,-0.364,-0.3117,21.0289,22.1426,24.5066,21.6887,23.8981,25.8179,25.4469,23.8362,24.6525,19.5653,16.7106,11.4517,-7.2383,-14.9242,-16.0902,-18.5923,-18.8091,-22.4965,-23.8244,-24.9691,-24.3305,-26.8881,-27.9147,-27.7722,-28.3863,-28.8221,-28.6626,-28.7132,-29.1245,-29.2217,-29.6713,-31.5739,-32.2537,-34.1009,-36.0828,-37.851,-40.0142,-28.9453,-40.4462,-41.8068,-37.1276,-34.9505,-42.6772,-38.7944,-39.0107,-30.8989,-42.1565,-43.1221,-50.1895,-53.9221,-52.9828,-52.2856,-46.0654,-41.9943,-17.8507,-7.8448,16.6484,36.0988,31.9213,49.6179,56.4552,55.4843,60.9414,53.0888,58.3509,16.201,53.5353,30.5955,31.5812,70.2442,43.5843,15.3357,21.9891,31.2909,19.218,21.1637,18.812,17.0035,13.7866,11.05,7.4257,7.1917,2.5825,0.1542,0.3483,3.0202,-4.2699,-9.1824,-12.0448,-6.2378,-15.6792,-16.2146,-12.0135,16.0326,-0.4547,30.1283,33.884,44.0955,14.9325,29.5527,34.1278,16.337,7.5901,10.7797,10.6771,22.492,20.0976,4.7695,2.9161,-0.671,-0.1006,-2.7751,-5.9016,-5.5431,-7.0452,-6.6212,3.2531,16.223,26.5729,5.7949,19.4386,14.8662,3.9513,-1.308,17.403,0.4562,9.0972,-4.0585,-6.3389,-6.2743,0.8599,11.7973,3.4355,8.4212,24.244,3.2666,7.489,5.0487,-5.4033,-2.8549,0.24,18.5348,38.6447,12.3853,1.9089,2.1248,2.1568,4.3336,2.6805,4.0872,2.6202,2.8419,2.1358,2.1666,2.0221,2.9659,2.859,2.9814,2.8797,3.003,0.6806,-0.2837,-1.0344,-1.2547,-1.2869,-1.1737,-1.1344,-0.7447,-0.1011,-0.8179,-0.5223,0.0353,-1.1832,-1.4274,-1.8171,-0.7272,-1.161,-0.9502,-0.3872,0.3548,-1.2153,0.3232,0.7956,0.7112,0.0764,-0.4566,-0.3934,-0.4062,-0.925,-1.2504,-1.0323,0.6897,0.5022,2.6704,1.1149,-0.3783,-0.3253,-0.1597,0.2448,-0.2405,-0.7295,-0.7195,-0.1859,-0.2154,-0.3098,0.1194,-0.7431,0.2435,-0.1143,1.2126,0.1945,3.8148,1.8226,1.8479,0.3683,1.3621,-0.4234,-1.2814,0.4477,0.4954,-0.2085,-1.034,0.771,-1.4797,0.3103,1.4818,0.6229,1.2285,1.9772,0.2659,-1.6144,-0.963,-3.3606,-1.4853,-1.3927,-1.5839,-2.8043,-3.2008,-1.8178,-0.5328,5.9407,6.1018,19.6396,19.0677,10.9568,5.132,19.9827,21.1293,-2.5856,-3.2889,-0.5477,0.0186,3.6825,13.0072,5.3243,2.5876,2.9173,2.2994,-2.3756,-1.3777,-1.1193,1.3578,1.2549,-1.7334,-2.6602,-2.4822,-3.1337,-1.3863,-0.1261,-0.0729,1.9506,1.2518,7.417,1.3713,0.3408,-1.6787,7.292,6.8566,-1.1997,2.4521,-0.8965,0.1556,20.5681,25.2491,24.8318,24.5273,19.0248,22.1463,21.4364,0.2551,3.0428,6.3694,7.9964,5.0829,3.2932,6.6744,3.992,5.4927,-0.5376,9.433,0.1141,0.5504,-0.8257,-0.9232,0.1801,-1.3318,-1.2829,-0.6166,-1.5789,0.8601,1.1742,-1.0012,-1.3565,-1.4326,-1.4901,-2.739,-3.2237,-2.9825,-2.7826,-2.5452,0.6573,0.3918,0.6337,1.1193,3.3813,1.2482,2.6647,5.7279,4.3353,5.5423,12.5321,9.5768,11.8941,5.3129,1.192,0.4976,0.9978,19.3527,1.5903,6.2258,28.7546,25.7909,33.3412,12.1921,15.9102,33.1964,26.7018,21.2832,20.9653,11.5205,4.6081,15.8782,20.735,22.6537,30.3597,28.9823,25.2993,29.4468,19.5647,24.8959,25.2958,19.1608,37.8909,33.4882,17.1336,32.5511,35.6879,16.4519,22.2183,31.966,29.7214,30.9575,45.6003,37.82,23.9842,39.7683,52.4253,31.3604,53.7384,56.8082,59.4882,43.2016,33.1022,38.2451,37.3269,29.2933,63.3533,62.7521,70.7051,56.0396,61.2525,40.8811,52.2344,31.1385,24.0528,10.3533,23.9589,7.2247,10.3877,5.1427,3.8634,2.2507,6.6894,12.6712,6.8191,5.7448,6.5626,8.6893,7.8921,7.4705,7.286,8.1261,7.2897,7.8582,8.1008,5.7726,5.9871,7.52,7.4141,7.4746,8.2822,6.3994,6.8658,6.4214,5.2919,3.8961,3.7704,2.9903,3.1459,3.3826,3.2412,4.3599,4.1734,4.8226,4.2624,3.3882,2.9341,2.7745,2.4633,1.7827,1.5858,1.416,1.6846,1.6585,2.1716,2.38,3.0027,3.609,3.4394,3.559,3.8304,3.696,3.7302,3.976,5.1283,4.6889,4.4421,4.8146,5.1755,5.8122,5.6591,5.7408,5.9903,6.5709,7.0393,7.0628,6.5418,4.2421,2.3539,2.2893,1.2886,1.2177,1.3184,1.1846,0.7587,0.8685,0.7453,0.5273,0.8011,0.8872);
    b_vector<float> sample_3 = MAKE_FLOAT_LIST(-0.0008,0.0181,0.1298,0.1815,0.1867,0.0526,0.0188,0.0228,0.3152,0.3559,0.3647,0.4213,0.4188,0.3888,0.3637,0.3224,0.3381,0.3207,0.3661,0.0648,0.31,0.0898,0.1397,0.0717,0.0467,0.0723,0.0797,0.0731,0.092,0.0722,0.0489,0.0544,0.026,0.0094,0.0587,0.0228,0.0515,0.0248,0.0335,0.04,0.0163,0.0122,-0.0051,0.011,0.0297,0.0119,-0.007,-0.0055,-0.0148,0.0213,0.0147,-0.0199,0.0043,-0.0345,-0.0381,-0.0179,0.0724,-0.0547,-0.0476,-0.0414,-0.1003,-0.036,-0.0125,-0.1081,-0.0829,-0.0567,-0.0848,-0.0756,-0.0662,0.0004,0.0119,-0.0443,-0.1457,-0.0321,0.2459,0.0467,0.0245,-0.0322,0.7073,0.047,-0.0045,0.0286,0.0969,0.0441,0.2032,0.1118,-0.0329,0.0157,0.06,-0.0293,0.0315,0.1653,0.2161,-0.0189,-0.0234,-0.0151,-0.0424,0.1009,0.0678,0.6316,0.0591,0.0906,0.0509,0.0123,-0.0017,0.0084,0.007,0.0588,-0.0323,0.0136,0.0076,0.0297,0.0469,0.1829,0.0388,0.1673,0.1224,0.0293,-0.0341,-0.062,-0.0525,-0.0175,-0.0547,-0.0659,-0.0374,-0.0015,-0.0197,0.1485,0.0662,0.0376,0.0305,0.6215,-0.0389,-0.0216,0.0208,0.0342,-0.0071,0.0928,-0.008,0.0198,-0.0334,0.2862,0.0633,-0.0031,0.0137,0.3178,-0.0281,-0.019,-0.0514,0.033,0.0191,0.0128,0.044,0.0256,0.042,0.0216,0.0327,0.0227,0.1621,0.0545,1.152,1.174,1.1844,1.1904,1.2068,1.204,1.1644,1.2163,1.1352,1.3351,1.358,1.1329,1.3142,1.1753,0.864,0.8296,0.8063,0.7952,0.7618,0.6983,0.7095,0.7348,0.7378,0.75,0.7157,0.7037,0.6352,0.6417,0.6317,0.6257,0.5844,0.5842,0.5626,0.5638,0.5836,0.5162,0.4703,0.4932,0.4551,0.432,0.4056,0.3723,0.3703,0.3313,0.3512,0.3036,0.2657,0.2948,0.255,0.22,0.2122,0.2004,0.1837,0.1291,0.2408,0.1195,0.2418,0.0517,0.6065,0.1456,-0.0313,0.482,0.1451,0.6451,0.165,0.5791,0.0382,0.0434,0.1329,0.1399,-0.0186,0.1311,-0.0038,0.0136,0.0534,0.0162,-0.0321,0.0002,-0.0508,-0.0696,-0.0172,-0.0782,-0.0518,-0.1074,-0.1444,-0.1142,-0.1462,0.1424,-0.1741,-0.1815,-0.1526,-0.1856,-0.1363,-0.2104,-0.2153,-0.2075,-0.1206,-0.1629,-0.1716,-0.0801,-0.0457,-0.0705,-0.0227,0.0054,-0.0152,-0.0549,-0.0447,0.504,-0.0483,-0.0357,-0.0167,-0.1114,-0.0885,-0.0568,-0.0964,-0.0942,-0.0802,-0.1241,-0.1409,-0.1239,-0.0561,0.0275,-0.0311,-0.0073,0.0058,-0.006,0.0161,-0.1271,-0.0358,-0.052,-0.1007,-0.0734,-0.0581,-0.0836,-0.1188,0.3044,-0.101,-0.0138,0.1909,0.205,0.6027,0.0879,-0.0649,0.1004,-0.0497,-0.0863,-0.0718,-0.0665,-0.0243,0.0222,-0.0026,-0.0443,-0.0116,0.0129,-0.0089,-0.0342,-0.0294,-0.0405,-0.0342,-0.0491,0.1469,0.1642,0.1605,0.1806,0.1808,0.196,0.1939,0.1973,0.2438,0.263,0.2645,0.2996,0.2812,0.3839,0.2696,0.2825,0.2466,0.2409,0.2271,0.1841,0.1431,0.1236,0.0909,0.1358,0.0438,0.0062,-0.0216,-0.021,-0.0191,-0.0176,-0.0279,0,0.0025,-0.0162,-0.0224,-0.0416,0.0567,-0.0239,-0.001,-0.0088,-0.054,-0.0198,-0.0456,-0.039,-0.091,-0.0849,-0.0807,-0.0691,-0.1182,-0.0688,-0.1289,-0.1154,-0.1131,-0.0087,-0.1288,-0.1256,-0.0161,0.196,0.6324,0.1096,-0.1572,0.6956,-0.035,0.7814,0.0145,0.2602,-0.0093,-0.0387,-0.0763,0.1807,0.001,0.3349,-0.1016,-0.0438,0.0356,0.0533,-0.0561,0.1241,0.0009,-0.0869,0.2139,0.2234,-0.1633,0.6105,-0.1319,-0.062,0.0117,-0.0841,-0.1341,-0.1885,0.3429,0.0297,-0.1712,0.0479,-0.2194,-0.0338,-0.0553,-0.2927,0.6835,-0.0196,0.3773,0.083,-0.0805,0.5064,0.1169,0.1232,-0.1357,0.3644,-0.1991,-0.1776,-0.0892,-0.203,0.2597,0.0186,0.3051,-0.1102,-0.1885,-0.1318,0.2174,0.1445,0.3881,0.4301,0.2083,0.3617,0.2252,0.315,0.1163,0.3371,-0.1338,-0.291,0.1837,0.0844,0.2287,-0.0356,0.4163,0.455,-0.1078,0.5248,0.2094,-0.3619,0.1366,-0.155,0.1412,0.2445,-0.1036,-0.1287,-0.2785,-0.2597,-0.1983,-0.3745,-0.1772,-0.3089,-0.215,-0.1013,-0.246,-0.2486,-0.2933,-0.2251,-0.364,-0.3117,21.0289,22.1426,24.5066,21.6887,23.8981,25.8179,25.4469,23.8362,24.6525,19.5653,16.7106,11.4517,-7.2383,-14.9242,-16.0902,-18.5923,-18.8091,-22.4965,-23.8244,-24.9691,-24.3305,-26.8881,-27.9147,-27.7722,-28.3863,-28.8221,-28.6626,-28.7132,-29.1245,-29.2217,-29.6713,-31.5739,-32.2537,-34.1009,-36.0828,-37.851,-40.0142,-28.9453,-40.4462,-41.8068,-37.1276,-34.9505,-42.6772,-38.7944,-39.0107,-30.8989,-42.1565,-43.1221,-50.1895,-53.9221,-52.9828,-52.2856,-46.0654,-41.9943,-17.8507,-7.8448,16.6484,36.0988,31.9213,49.6179,56.4552,55.4843,60.9414,53.0888,58.3509,16.201,53.5353,30.5955,31.5812,70.2442,43.5843,15.3357,21.9891,31.2909,19.218,21.1637,18.812,17.0035,13.7866,11.05,7.4257,7.1917,2.5825,0.1542,0.3483,3.0202,-4.2699,-9.1824,-12.0448,-6.2378,-15.6792,-16.2146,-12.0135,16.0326,-0.4547,30.1283,33.884,44.0955,14.9325,29.5527,34.1278,16.337,7.5901,10.7797,10.6771,22.492,20.0976,4.7695,2.9161,-0.671,-0.1006,-2.7751,-5.9016,-5.5431,-7.0452,-6.6212,3.2531,16.223,26.5729,5.7949,19.4386,14.8662,3.9513,-1.308,17.403,0.4562,9.0972,-4.0585,-6.3389,-6.2743,0.8599,11.7973,3.4355,8.4212,24.244,3.2666,7.489,5.0487,-5.4033,-2.8549,0.24,18.5348,38.6447,12.3853,1.9089,2.1248,2.1568,4.3336,2.6805,4.0872,2.6202,2.8419,2.1358,2.1666,2.0221,2.9659,2.859,2.9814,2.8797,3.003,0.6806,-0.2837,-1.0344,-1.2547,-1.2869,-1.1737,-1.1344,-0.7447,-0.1011,-0.8179,-0.5223,0.0353,-1.1832,-1.4274,-1.8171,-0.7272,-1.161,-0.9502,-0.3872,0.3548,-1.2153,0.3232,0.7956,0.7112,0.0764,-0.4566,-0.3934,-0.4062,-0.925,-1.2504,-1.0323,0.6897,0.5022,2.6704,1.1149,-0.3783,-0.3253,-0.1597,0.2448,-0.2405,-0.7295,-0.7195,-0.1859,-0.2154,-0.3098,0.1194,-0.7431,0.2435,-0.1143,1.2126,0.1945,3.8148,1.8226,1.8479,0.3683,1.3621,-0.4234,-1.2814,0.4477,0.4954,-0.2085,-1.034,0.771,-1.4797,0.3103,1.4818,0.6229,1.2285,1.9772,0.2659,-1.6144,-0.963,-3.3606,-1.4853,-1.3927,-1.5839,-2.8043,-3.2008,-1.8178,-0.5328,5.9407,6.1018,19.6396,19.0677,10.9568,5.132,19.9827,21.1293,-2.5856,-3.2889,-0.5477,0.0186,3.6825,13.0072,5.3243,2.5876,2.9173,2.2994,-2.3756,-1.3777,-1.1193,1.3578,1.2549,-1.7334,-2.6602,-2.4822,-3.1337,-1.3863,-0.1261,-0.0729,1.9506,1.2518,7.417,1.3713,0.3408,-1.6787,7.292,6.8566,-1.1997,2.4521,-0.8965,0.1556,20.5681,25.2491,24.8318,24.5273,19.0248,22.1463,21.4364,0.2551,3.0428,6.3694,7.9964,5.0829,3.2932,6.6744,3.992,5.4927,-0.5376,9.433,0.1141,0.5504,-0.8257,-0.9232,0.1801,-1.3318,-1.2829,-0.6166,-1.5789,0.8601,1.1742,-1.0012,-1.3565,-1.4326,-1.4901,-2.739,-3.2237,-2.9825,-2.7826,-2.5452,0.6573,0.3918,0.6337,1.1193,3.3813,1.2482,2.6647,5.7279,4.3353,5.5423,12.5321,9.5768,11.8941,5.3129,1.192,0.4976,0.9978,19.3527,1.5903,6.2258,28.7546,25.7909,33.3412,12.1921,15.9102,33.1964,26.7018,21.2832,20.9653,11.5205,4.6081,15.8782,20.735,22.6537,30.3597,28.9823,25.2993,29.4468,19.5647,24.8959,25.2958,19.1608,37.8909,33.4882,17.1336,32.5511,35.6879,16.4519,22.2183,31.966,29.7214,30.9575,45.6003,37.82,23.9842,39.7683,52.4253,31.3604,53.7384,56.8082,59.4882,43.2016,33.1022,38.2451,37.3269,29.2933,63.3533,62.7521,70.7051,56.0396,61.2525,40.8811,52.2344,31.1385,24.0528,10.3533,23.9589,7.2247,10.3877,5.1427,3.8634,2.2507,6.6894,12.6712,6.8191,5.7448,6.5626,8.6893,7.8921,7.4705,7.286,8.1261,7.2897,7.8582,8.1008,5.7726,5.9871,7.52,7.4141,7.4746,8.2822,6.3994,6.8658,6.4214,5.2919,3.8961,3.7704,2.9903,3.1459,3.3826,3.2412,4.3599,4.1734,4.8226,4.2624,3.3882,2.9341,2.7745,2.4633,1.7827,1.5858,1.416,1.6846,1.6585,2.1716,2.38,3.0027,3.609,3.4394,3.559,3.8304,3.696,3.7302,3.976,5.1283,4.6889,4.4421,4.8146,5.1755,5.8122,5.6591,5.7408,5.9903,6.5709,7.0393,7.0628,6.5418,4.2421,2.3539,2.2893,1.2886,1.2177,1.3184,1.1846,0.7587,0.8685,0.7453,0.5273,0.8011,0.8872);

    vector<b_vector<float>> samples;
    samples.push_back(sample_1);
    samples.push_back(sample_2);
    samples.push_back(sample_3);

    // simulate label feedback
    vector<String> true_labels = MAKE_STRING_LIST("idle", "fall", "step");

    // Perform predictions on all samples
    unsigned long total_time = 0;
    uint8_t correct_predictions = 0;
    
    Serial.println("\n=== Prediction Results ===");
    Serial.println("Sample | Predicted | Actual   | Time (Î¼s) | Match");
    Serial.println("-------|-----------|----------|-----------|------");
    
    for (int i = 0; i < samples.size(); i++){
        rf_predict_result_t result;
        forest.predict(samples[i], result);
        
        if (!result.success) {
            Serial.printf("  %d    | FAILED    |          |           | âœ—\n", i+1);
            continue;
        }
        
        total_time += result.prediction_time;
        forest.add_actual_label(true_labels[i]);
        
        bool is_correct = (strcmp(result.label, true_labels[i].c_str()) == 0);
        const char* match = is_correct ? "âœ“" : "âœ—";
        if (is_correct) correct_predictions++;
        
        Serial.printf("  %d    | %-9s | %-8s | %9lu | %s\n", 
                     i+1, result.label, true_labels[i].c_str(), 
                     result.prediction_time, match);
    }
    
    Serial.println("-----------------------------------------------");
    Serial.printf("Total samples: %d\n", samples.size());
    Serial.printf("Correct predictions: %d/%d (%.1f%%)\n", 
                  correct_predictions, samples.size(), 
                  (correct_predictions * 100.0f) / samples.size());
    Serial.printf("Average prediction time: %lu Î¼s\n", total_time / samples.size());
    Serial.println();
    
    // Clean up and compute statistics
    Serial.print("\nReleasing forest from memory... ");
    if (forest.releaseForest()) {
        Serial.println("âœ… OK");
    } else {
        Serial.println("âš ï¸  WARNING: Release failed");
    }
    
    // Optional: Write pending data to dataset for retraining
    // forest.flush_pending_data();

    // Display inference statistics
    Serial.println("\n=== Model Performance Metrics ===");
    float p_score = forest.get_practical_inference_score();
    Serial.printf("Practical Inference Score: %.3f (%.1f%%)\n", p_score, p_score * 100.0f);
    
    int total_logged = forest.get_total_logged_inference();
    Serial.printf("Total Logged Inferences: %d\n", total_logged);

    long unsigned end_forest = mcu::platform::Rf_get_current_time(mcu::platform::TimeUnit::MILLISECONDS);
    Serial.println("\n=== Execution Summary ===");
    Serial.printf("Total execution time: %lu ms\n", end_forest - start_forest);
    Serial.println("\nâœ… Example completed successfully!\n");
}

void loop() {
    // manage_files();
}