/*
 * Walker Fall Detection Example
 * 
 * This example demonstrates real-time activity classification using a Random Forest
 * model trained to detect different human activities (idle, walking, motion, falling).
 * 
 * Features:
 * - Loads pre-trained Random Forest model from filesystem
 * - Performs predictions on 8 sample feature vectors (234 features each)
 * - Compares predictions against ground truth labels
 * - Calculates accuracy and timing metrics
 * - Supports actual label feedback for continuous learning
 * 
 * Hardware: ESP32 or compatible microcontroller with LittleFS support
 * Dataset: Walker fall detection with accelerometer/gyroscope features
 */

#define DEV_STAGE    
#define RF_DEBUG_LEVEL 2

#include "random_forest_mcu.h"

using namespace mcu;

void setup() {
    Serial.begin(115200);  
    while (!Serial);       // <-- Waits for Serial monitor to connect (important for USB CDC)

    Serial.println("\n╔════════════════════════════════════════════════════╗");
    Serial.println("║  Walker Fall Detection - Random Forest Example    ║");
    Serial.println("╚════════════════════════════════════════════════════╝\n");
    
    delay(1000);

    // Initialize filesystem
    Serial.print("Initializing LittleFS... ");
    if (!LittleFS.begin(true)) {
        Serial.println("❌ FAILED");
        return;
    }
    Serial.println("✅ OK");
    
    manage_files();
    delay(500);
    
    long unsigned start_forest = GET_CURRENT_TIME_IN_MILLISECONDS;
    
    // Initialize Random Forest model
    Serial.print("Loading model 'walker_fall'... ");
    const char* model_name = "walker_fall"; 
    RandomForest forest = RandomForest(model_name);
    
    // Optional: Configure forest parameters before training
    // forest.set_num_trees(20);
    // forest.set_random_seed(42);
    // forest.set_training_score(Rf_training_score::OOB_SCORE); 
    
    // Optional: Train or build model (commented out for pre-trained model)
    forest.build_model();
    forest.training(1);
    
    // Load pre-trained forest from filesystem
    if (!forest.loadForest()) {
        Serial.println("❌ FAILED");
        return;
    }

    // Optional: Enable dataset extension for online learning
    // forest.enable_extend_base_data();

    // simulate prediction in real-world 
    b_vector<float> sample_1 = MAKE_FLOAT_LIST(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01);
    b_vector<float> sample_2 = MAKE_FLOAT_LIST(-0.0008,0.0181,0.1298,0.1815,0.1867,0.0526,0.0188,0.0228,0.3152,0.3559,0.3647,0.4213,0.4188,0.3888,0.3637,0.3224,0.3381,0.3207,0.3661,0.0648,0.31,0.0898,0.1397,0.0717,0.0467,0.0723,0.0797,0.0731,0.092,0.0722,0.0489,0.0544,0.026,0.0094,0.0587,0.0228,0.0515,0.0248,0.0335,0.04,0.0163,0.0122,-0.0051,0.011,0.0297,0.0119,-0.007,-0.0055,-0.0148,0.0213,0.0147,-0.0199,0.0043,-0.0345,-0.0381,-0.0179,0.0724,-0.0547,-0.0476,-0.0414,-0.1003,-0.036,-0.0125,-0.1081,-0.0829,-0.0567,-0.0848,-0.0756,-0.0662,0.0004,0.0119,-0.0443,-0.1457,-0.0321,0.2459,0.0467,0.0245,-0.0322,0.7073,0.047,-0.0045,0.0286,0.0969,0.0441,0.2032,0.1118,-0.0329,0.0157,0.06,-0.0293,0.0315,0.1653,0.2161,-0.0189,-0.0234,-0.0151,-0.0424,0.1009,0.0678,0.6316,0.0591,0.0906,0.0509,0.0123,-0.0017,0.0084,0.007,0.0588,-0.0323,0.0136,0.0076,0.0297,0.0469,0.1829,0.0388,0.1673,0.1224,0.0293,-0.0341,-0.062,-0.0525,-0.0175,-0.0547,-0.0659,-0.0374,-0.0015,-0.0197,0.1485,0.0662,0.0376,0.0305,0.6215,-0.0389,-0.0216,0.0208,0.0342,-0.0071,0.0928,-0.008,0.0198,-0.0334,0.2862,0.0633,-0.0031,0.0137,0.3178,-0.0281,-0.019,-0.0514,0.033,0.0191,0.0128,0.044,0.0256,0.042,0.0216,0.0327,0.0227,0.1621,0.0545,1.152,1.174,1.1844,1.1904,1.2068,1.204,1.1644,1.2163,1.1352,1.3351,1.358,1.1329,1.3142,1.1753,0.864,0.8296,0.8063,0.7952,0.7618,0.6983,0.7095,0.7348,0.7378,0.75,0.7157,0.7037,0.6352,0.6417,0.6317,0.6257,0.5844,0.5842,0.5626,0.5638,0.5836,0.5162,0.4703,0.4932,0.4551,0.432,0.4056,0.3723,0.3703,0.3313,0.3512,0.3036,0.2657,0.2948,0.255,0.22,0.2122,0.2004,0.1837,0.1291,0.2408,0.1195,0.2418,0.0517,0.6065,0.1456,-0.0313,0.482,0.1451,0.6451,0.165,0.5791,0.0382,0.0434,0.1329,0.1399,-0.0186,0.1311,-0.0038,0.0136);
    b_vector<float> sample_3 = MAKE_FLOAT_LIST(0.02,0.02,0.0276,0.0201,0,0,0,0.0107,0.0291,0.0228,0.0333,0.04,0.036,0.0314,0.0449,0.0497,0.04,0.04,0.036,0.027,0.01,0.01,0.0021,0.0051,0.0105,0.02,0.0276,0.0409,0.05,0.05,0.05,0.02,0.0371,0.0348,0.0578,0.0674,0.0171,0.0049,-0.0164,-0.0123,-0.01,-0.01,-0.01,0.03,0.0364,0.0213,-0.0214,0.0476,0.0543,0.0426,0.0487,0.0547,0.06,0.0502,0.0256,0.0132,0.0044,0.0355,0.0484,0.0174,0.0076,0.0717,0.0446,-0.029,0.061,0.0625,0.0317,0.0551,-0.0256,-0.0005,-0.0266,0.0177,-0.0194,0.0171,-0.0076,-0.0207,-0.0138,0.1063,0.0922,0.04,0.0557,0.0948,0.094,0.0998,0.0415,0.0475,0.018,0.0027,-0.0172,-0.0323,-0.0389,-0.0291,0.0092,0.0449,0.0223,-0.0223,0.0431,0.0579,-0.0029,0.01,0.006,-0.0203,-0.02,-0.0043,0.0114,-0.0722,0.0549,0.0365,0.0759,-0.014,0.0006,0.0153,0.0299,0.0446,0.1003,0.0153,-0.0317,-0.0162,-0.0033,0.0097,0.0353,0.0449,0.0125,0.0215,0.0477,0.0298,-0.0016,0.0287,0.0047,-0.0008,0.0135,0.0198,0.0139,0.01,0.01,0.0308,0.04,0.0455,0.0429,0.03,0.0273,0.0174,0.011,0.0011,0,0.005,0.0247,0.0199,0.0136,0.024,0.0228,0.0307,0.04,0.04,0.04,0.0213,0,0,0.01,0.01,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.9867,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.9749,0.989,0.97,0.9776,0.97,0.97,0.97,0.97,0.985,0.9841,0.9748,0.9778,0.9874,0.9458,0.9702,0.9736,0.98,0.9427,0.9732,1.0037,0.98,0.9864,0.9846,0.9725,1.0088,0.9772,0.9777,0.996,1.0142,1.017,0.96,1.0105,0.9655,0.882,0.9989,0.9207,0.9057,0.9718,0.9017,0.9692,1.0489,1.0097,0.9887,1.0227,0.997,0.9717,1.0134,0.9219,0.9767,1.0258,0.9772);
    b_vector<float> sample_4 = MAKE_FLOAT_LIST(-0.0348,-0.0104,0.0309,0.0373,0.0498,0.06,0.0984,0.081,0.0559,0.0215,-0.0022,-0.0283,-0.0464,-0.0405,-0.0319,-0.0313,0.0146,0.03,0.051,0.06,0.06,0.0506,0.0294,0.0253,0.0212,0.0024,-0.0082,0.0043,0.01,0.01,0,0,0,0,0.0117,0.0251,0.03,0.0301,0.0383,0.0258,0.02,0.02,0.01,0.01,0.01,0.01,0.011,0.0295,0.04,0.031,0.0157,0,0,0,0.02,0.0157,0.01,0.01,0.0219,0.03,0.03,0.03,0.02,0.0156,0.0136,0.0197,0.02,0.02,0.02,0.02,0.02,0.02,0.0137,0.0195,0.03,0.034,0.0364,0.0301,0.0089,0,0,0,0,0.0086,0.02,0.0296,0.0287,0.02,0.02,0.02,0.03,0.03,0.03,0.0115,0.0088,0,0.0066,0.01,0.0115,0.0213,0.0255,0.0298,0.0186,0.01,0.01,0.0196,0.02,0.02,0.0137,0.0144,0.02,0.02,0.02,0.0114,0.01,0.0141,0.02,0.0105,0.0109,0.02,0.02,0.0292,0.02,0.02,0.01,0.01,0.01,0.01,0.0168,0.0288,0.03,0.03,0.03,0.0211,0.0177,0.0055,0.0038,0.01,0.0187,0.0128,0.01,0.01,0.0043,0.0133,0.0136,0.0375,0.03,0.0263,0.02,0.0114,0.0179,0.01,0.0029,0.0187,-0.0081,-0.0105,-0.0151,0.0099,0.034,0.0158,0.9963,0.9904,0.9709,0.9773,0.9802,0.9787,0.9832,1.0045,0.9888,0.9705,0.9889,0.9758,0.97,0.9795,0.99,0.9813,0.9839,0.99,0.98,0.98,0.98,0.98,0.99,0.99,0.99,0.9812,0.98,0.98,0.973,0.97,0.97,0.9743,0.98,0.98,0.98,0.98,0.98,0.9899,0.98,0.9758,0.9766,0.98,0.9719,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.978,0.9739,0.98,0.98,0.98,0.98,0.98,0.98);
    b_vector<float> sample_5 = MAKE_FLOAT_LIST(0.02,0.0172,0.01,0.002,-0.0099,0.0024,0.0155,0.0357,0.02,0.0166,0.0157,0.02,0.0106,0.0171,0.0154,0.02,0.0109,0.01,0.0153,0.02,0.02,0.01,0.0079,0.0037,0,0.01,0.0154,0.0278,0.0001,0.0298,0.0263,0.0286,0.0094,-0.0047,0.0218,0.0135,0.0009,0.0102,0.0092,0.03,0.0376,0.0168,0.0249,0.0113,0.0088,0.0054,0.037,0.0307,0.0282,-0.0283,-0.0206,-0.0128,-0.005,0.0027,0.0105,0.0183,0.0162,0.025,0.0531,0.0058,0.0025,0.0199,0.0457,0.0624,0.0294,-0.0035,0.0028,0.0007,-0.0301,-0.0234,0.0283,0.0121,0.0297,0.0248,0.02,0.0151,0.0102,-0.0189,0.1012,-0.0066,-0.0128,-0.0373,-0.03,-0.03,0.0132,0.0475,0.036,0.0004,0.0286,-0.0238,0.0007,0.0543,0.0501,0.0564,0.0545,0.0416,-0.01,-0.01,0.0131,-0.0016,-0.0151,-0.0147,0.0117,0.0518,0.0418,-0.0141,0.0041,0.0166,0.0146,0,0.0105,-0.0007,0.0194,0.0061,0.0251,0.0217,0.0146,0.0125,0.0357,0.0328,0.0109,0.0117,0.0067,0.0173,0.0131,0.02,0.0252,0.03,0.03,0.0288,0.0225,0.0276,0.0296,0.02,0.02,0.01,0.0102,0.0168,0.01,0.018,0.02,0.02,0.02,0.02,0.01,0.01,0.01,0.006,0,0.0171,0.0356,0.0318,0.0293,0.0085,0.0023,0,0.0001,0.0064,0.0151,0.02,0.9708,0.98,0.9694,0.968,0.9799,0.9712,0.9777,0.9878,0.9894,0.98,0.9857,0.9752,0.98,0.9771,0.9754,0.98,0.98,0.9768,0.9753,0.9838,0.9885,0.973,0.98,0.98,0.98,0.967,0.9692,0.9639,0.9601,0.993,0.9763,0.9862,0.9797,0.9674,0.96,0.9848,0.9695,0.9633,0.9844,1.0078,0.9976,0.9836,1.0049,0.9738,0.9945,0.9285,0.9848,1.0166,0.9491,0.9217,0.9294,0.9372,0.945,0.9527,0.9605,0.9683,0.9662,0.975,0.9852,0.9717,0.9631,0.9675,0.97,0.9841,1.0104,1.0368,1.05,1.0076,0.9401,0.9848,0.9909,0.9779,0.97,0.97);
    b_vector<float> sample_6 = MAKE_FLOAT_LIST(0.02,0.0295,0.0379,0.0251,0.0125,0.01,0.0023,0.0144,0.02,0.03,0.03,0.03,0.03,0.03,0.0144,0.0132,0.02,0.02,0.0084,0.0043,0.01,0.0196,0.02,0.0158,0.0165,0.02,0.022,0.03,0.03,0.0204,0.0177,0.01,0.01,0.0191,0.0213,0.03,0.0235,0.0101,0.0079,0.0042,0.01,0.01,0.01,0.01,0.0135,0.0197,0.0318,0.0356,0.0232,0.02,0.02,0.02,0.02,0.0107,0.01,0.01,0.01,0.01,0.0158,0.0241,0.03,0.03,0.0268,0.01,0.01,0.01,0.0078,0.0042,0.01,0.0197,0.03,0.0276,0.0214,0.01,0.01,0.01,0.01,0.01,0.0159,0.02,0.02,0.0101,0.01,0.01,0.0168,0.0247,0.03,0.0213,0.01,0.01,0.0122,0.02,0.027,0.03,0.0188,0.0052,0,0.0097,0.02,0.02,0.0272,0.03,0.0277,0.02,0.02,0.02,0.0177,0.01,0.01,0.0102,0.0177,0.01,0.0169,0.02,0.02,0.02,0.0269,0.03,0.0242,0.01,0.01,0.01,0.0179,0.01,0.01,0.01,0.02,0.02,0.0274,0.03,0.02,0.0239,0.03,0.03,0.02,0.0157,0.0027,0,0.01,0.0143,0.02,0.0298,0.02,0.0249,0.03,0.0206,0.0182,0.0142,0.02,0.02,0.01,0.01,0.01,0.0197,0.02,0.02,0.02,0.02,0.0259,0.0145,0.9885,0.98,0.9879,0.98,0.98,0.9895,0.9723,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.9712,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98);
    b_vector<float> sample_7 = MAKE_FLOAT_LIST(0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.0262,0.0203,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.0264,0.039,0.04,0.01,0.01,0.01,0.03,0.0336,0.0274,0.0114,0.01,0.01,0.01,0.01,0.01,0.02,0.0266,0.03,0.038,0.03,0.0227,0.02,0.02,0.02,0.01,0.01,0.02,0.024,0.03,0.021,0.02,0.02,0.02,0.0107,0.01,0.01,0.02,0.02,0.0221,0.03,0.03,0.03,0.02,0.02,0.02,0.02,0.0216,0.03,0.03,0.03,0.0299,0.02,0.02,0.02,0.0114,0.02,0.02,0.02,0.03,0.026,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.024,0.03,0.0212,0.02,0.02,0.02,0.02,0.02,0.0239,0.03,0.0395,0.0444,0.0243,0.0366,0.0226,-0.0002,-0.01,-0.0035,0.0093,0.0309,0.0437,0.05,0.05,0.0291,0.02,0.02,0.02,0,0.0039,0.0159,0.0291,0.0301,0.04,0.0337,0.03,0.0241,0.01,0.01,0.01,0.02,0.024,0.03,0.03,0.0284,0.02,0.0168,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.9759,0.9636,0.978,0.986,0.973,0.96,0.9691,0.9817,0.9864,0.98,0.98,0.9717,0.98,0.9737,0.9743,0.98,0.97,0.9766,0.98,0.98,0.9758,0.9773,0.9754,0.9704,0.9769,0.98,0.98,0.98);
    b_vector<float> sample_8 = MAKE_FLOAT_LIST(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01);
    b_vector<float> sample_9 = MAKE_FLOAT_LIST(0,0,-0.0054,-0.01,-0.01,-0.01,-0.01,-0.0178,-0.02,-0.02,-0.0154,-0.01,-0.01,-0.01,-0.0057,0.0064,0.01,0.0062,0,0,-0.0093,-0.01,-0.01,-0.01,0.0036,0.0236,0.0159,0.0115,0.01,0.01,0.0084,0.0048,0.0012,-0.01,-0.01,-0.01,-0.0191,-0.0166,-0.0051,0,0,0.01,0.01,0.01,0.0006,-0.03,-0.03,-0.0367,-0.06,-0.042,0.02,0.0131,0,0,-0.0026,-0.0225,-0.0154,0.0069,0.02,0.02,-0.02,-0.02,0.01,-0.0148,-0.02,-0.0086,0.02,-0.0186,-0.0139,-0.04,-0.0003,0.011,0.0034,0.0383,0.0168,-0.0463,-0.02,-0.0035,-0.0097,-0.0939,-0.0719,-0.0241,-0.0738,0.0358,0.0263,0.0108,0.0501,0.0749,-0.0198,-0.0123,-0.0067,-0.0301,-0.0478,-0.0486,-0.0285,0.0477,0.0269,0.0003,-0.032,0,-0.0205,-0.0758,-0.0714,-0.0304,0.0095,0.0173,0.0568,-0.0104,-0.0214,-0.03,-0.024,-0.02,-0.0293,-0.02,-0.0145,-0.0034,-0.0123,-0.0576,-0.091,-0.0902,-0.0754,-0.0326,-0.01,-0.0164,-0.0109,0.04,0.0425,0.0294,0.0299,0.02,0.0131,-0.0081,-0.0346,-0.05,-0.05,-0.05,-0.0273,-0.0076,0.0046,0.0131,0.0188,0.0244,0.0311,0,-0.0093,-0.0252,-0.0415,-0.049,-0.0398,-0.0194,-0.005,0,0,0,-0.0045,-0.0164,-0.02,-0.02,-0.02,-0.02,-1.0118,-1.0171,-1.01,-1.0183,-1.0117,-1.0165,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.0073,-1.0043,-1.0036,-1.0097,-1.0038,-1.01,-1.003,-1,-1,-1,-1,-1,-1.0032,-1.0041,-1,-1,-1.0032,-1.01,-1.01,-1.01,-0.9962,-0.9782,-0.9959,-1.0091,-1.0066,-0.9951,-1.0017,-1.0193,-1.0011,-1.0077,-0.99,-0.9711,-1.052,-1.0435,-0.9662,-0.9741,-1.0145,-1.016,-1.0069,-1.0264,-0.9988,-1.0357,-0.9598,-0.9593,-0.9995,-1.0068,-1.0183,-1.01,-1.01,-1.0048,-1.0409,-0.9334,-1.0286,-1.057,-1.0368,-0.8668,-0.9723,-0.9997,-0.9297,-0.958,-1.0241);
    b_vector<float> sample_10 = MAKE_FLOAT_LIST(0.0211,0.0036,-0.0088,-0.0227,-0.03,-0.0215,-0.0088,0,0,0,0.0001,0.0071,0.0043,0.01,0.0197,0.01,0.0083,0.0042,0.0002,-0.01,-0.01,-0.01,0.001,0.01,0.01,0.01,0.0093,-0.0035,-0.02,-0.02,-0.0155,-0.0036,0,0,0.0027,0.02,0.02,0.02,-0.0114,-0.03,-0.03,-0.0271,-0.0202,-0.0182,-0.0164,-0.0145,-0.0127,-0.0109,-0.0042,0.0069,0.0023,0.0361,0.04,0.0186,-0.01,-0.01,-0.01,-0.01,-0.0482,-0.0391,-0.0328,-0.0266,-0.0203,-0.0146,-0.0025,0.0434,0.05,0.0472,0.034,0.0226,-0.0293,-0.0243,-0.04,-0.0239,0.0028,0.0181,-0.0427,-0.0313,0.0281,0.0168,0.0031,-0.0105,0.018,-0.0142,-0.0032,0.0158,0.0767,0.0082,-0.011,-0.0277,0.0153,0.0527,-0.0266,-0.0336,-0.0019,0.022,0.0128,-0.0169,-0.05,-0.0527,-0.0552,-0.0386,-0.0219,0.0184,-0.0145,-0.0326,-0.0443,-0.0477,-0.0165,0,0,0,0.004,-0.0259,-0.0216,-0.03,-0.0293,-0.026,-0.0228,-0.025,-0.0055,0.01,0.0005,-0.0005,-0.0071,-0.01,-0.01,-0.01,-0.01,-0.01,-0.0053,-0.01,-0.01,-0.01,-0.0193,-0.02,-0.02,-0.0131,-0.0006,0,0,-0.01,-0.0053,0,-0.0034,-0.0087,-0.0082,-0.0032,0.0042,0.0094,0.0078,0.0062,0.0046,0.003,0.0014,-0.0004,-0.0049,-0.0093,-0.0134,-0.01,-1.0056,-1,-1,-1,-1.0053,-1.0015,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1.0052,-1.0174,-1.0295,-1.0077,-1.0046,-1.0014,-1.0031,-1.0199,-0.9939,-1.0081,-1.0014,-1.0165,-1,-1,-1.0055,-1,-1.0049,-0.9963,-0.9927,-1.0211,-0.9975,-0.992,-1.0364,-0.9926,-1.0054,-1.0129,-0.9904,-0.9882,-0.9864,-0.9845,-0.9827,-0.9809,-0.9858,-0.9969,-1.0289,-1.0155,-0.9857,-0.9986,-0.9723,-1.0209,-0.9986,-0.9912,-0.9865,-1.0358,-1.0077,-0.9795,-0.9514,-0.999,-1.0575,-0.981,-1.0402,-1.033,-0.96,-0.9028,-1.0387,-1.02,-0.9634,-0.9745);

    vector<b_vector<float>> samples;
    samples.push_back(sample_1);
    samples.push_back(sample_2);
    samples.push_back(sample_3);
    samples.push_back(sample_4);
    samples.push_back(sample_5);
    samples.push_back(sample_6);
    samples.push_back(sample_7);
    samples.push_back(sample_8);
    samples.push_back(sample_9);
    samples.push_back(sample_10);

    // simulate label feedback
    vector<String> true_labels = MAKE_STRING_LIST("idle", "fall", "step", "motion", "step", "motion", "idle", "idle", "step", "step");

    // Perform predictions on all samples
    unsigned long total_time = 0;
    uint8_t correct_predictions = 0;
    
    Serial.println("\n=== Prediction Results ===");
    Serial.println("Sample | Predicted | Actual   | Time (μs) | Match");
    Serial.println("-------|-----------|----------|-----------|------");
    
    for (int i = 0; i < samples.size(); i++){
        RandomForest::rf_predict_result_t result;
        forest.predict(samples[i], result);
        
        if (!result.success) {
            Serial.printf("  %d    | FAILED    |          |           | ✗\n", i+1);
            continue;
        }
        
        total_time += result.prediction_time;
        forest.add_actual_label(true_labels[i]);
        
        bool is_correct = (strcmp(result.label, true_labels[i].c_str()) == 0);
        const char* match = is_correct ? "✓" : "✗";
        if (is_correct) correct_predictions++;
        
        Serial.printf("  %d    | %-9s | %-8s | %9lu | %s\n", 
                     i+1, result.label, true_labels[i].c_str(), 
                     result.prediction_time, match);
    }
    
    Serial.println("-----------------------------------------------");
    Serial.printf("Total samples: %d\n", samples.size());
    Serial.printf("Correct predictions: %d/%d (%.1f%%)\n", 
                  correct_predictions, samples.size(), 
                  (correct_predictions * 100.0f) / samples.size());
    Serial.printf("Average prediction time: %lu μs\n", total_time / samples.size());
    Serial.println();
    
    // Clean up and compute statistics
    Serial.print("\nReleasing forest from memory... ");
    if (forest.releaseForest()) {
        Serial.println("✅ OK");
    } else {
        Serial.println("⚠️  WARNING: Release failed");
    }
    
    // Optional: Write pending data to dataset for retraining
    // forest.flush_pending_data();

    // Display inference statistics
    Serial.println("\n=== Model Performance Metrics ===");
    float p_score = forest.get_practical_inference_score();
    Serial.printf("Practical Inference Score: %.3f (%.1f%%)\n", p_score, p_score * 100.0f);
    
    int total_logged = forest.get_total_logged_inference();
    Serial.printf("Total Logged Inferences: %d\n", total_logged);

    long unsigned end_forest = GET_CURRENT_TIME_IN_MILLISECONDS;
    Serial.println("\n=== Execution Summary ===");
    Serial.printf("Total execution time: %lu ms\n", end_forest - start_forest);
    Serial.println("\n✅ Example completed successfully!\n");
}

void loop() {
    // manage_files();
}