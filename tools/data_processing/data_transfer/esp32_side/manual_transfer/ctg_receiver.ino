#include "Rf_categorizer.h"
#include "STL_MCU.h"
#include "Rf_file_manager.h"

using namespace mcu;

Rf_categorizer categorizer;

void setup() {
    Serial.begin(115200);
    delay(1000);
    
    // Initialize SPIFFS
    if (!SPIFFS.begin(true)) {
        Serial.println("SPIFFS initialization failed!");
        return;
    }

    categorizer.receiveFromSerialMonitor(); 

    // testing new categorizer
    // this one is from walker_fall.csv. take another one for your specific dataset
    b_vector<float> test_sample = MAKE_FLOAT_LIST(2,0.02,0.02,0.0276,0.0201,0,0,0,0.0107,0.0291,0.0228,0.0333,0.04,0.036,
        0.0314,0.0449,0.0497,0.04,0.04,0.036,0.027,0.01,0.01,0.0021,0.0051,0.0105,0.02,0.0276,0.0409,0.05,0.05,0.05,0.02,
        0.0371,0.0348,0.0578,0.0674,0.0171,0.0049,-0.0164,-0.0123,-0.01,-0.01,-0.01,0.03,0.0364,0.0213,-0.0214,0.0476,
        0.0543,0.0426,0.0487,0.0547,0.06,0.0502,0.0256,0.0132,0.0044,0.0355,0.0484,0.0174,0.0076,0.0717,0.0446,-0.029,
        0.061,0.0625,0.0317,0.0551,-0.0256,-0.0005,-0.0266,0.0177,-0.0194,0.0171,-0.0076,-0.0207,-0.0138,0.1063,0.0922,
        0.04,0.0557,0.0948,0.094,0.0998,0.0415,0.0475,0.018,0.0027,-0.0172,-0.0323,-0.0389,-0.0291,0.0092,0.0449,0.0223,
        -0.0223,0.0431,0.0579,-0.0029,0.01,0.006,-0.0203,-0.02,-0.0043,0.0114,-0.0722,0.0549,0.0365,0.0759,-0.014,0.0006,
        0.0153,0.0299,0.0446,0.1003,0.0153,-0.0317,-0.0162,-0.0033,0.0097,0.0353,0.0449,0.0125,0.0215,0.0477,0.0298,-0.0016,
        0.0287,0.0047,-0.0008,0.0135,0.0198,0.0139,0.01,0.01,0.0308,0.04,0.0455,0.0429,0.03,0.0273,0.0174,0.011,0.0011,
        0,0.005,0.0247,0.0199,0.0136,0.024,0.0228,0.0307,0.04,0.04,0.04,0.0213,0,0,0.01,0.01,0.98,0.98,0.98,0.98,0.98,
        0.98,0.98,0.98,0.98,0.98,0.9867,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.98,0.9749,0.989,0.97,
        0.9776,0.97,0.97,0.97,0.97,0.985,0.9841,0.9748,0.9778,0.9874,0.9458,0.9702,0.9736,0.98,0.9427,0.9732,1.0037,0.98,
        0.9864,0.9846,0.9725,1.0088,0.9772,0.9777,0.996,1.0142,1.017,0.96,1.0105,0.9655,0.882,0.9989,0.9207,0.9057,0.9718,
        0.9017,0.9692,1.0489,1.0097,0.9887,1.0227,0.997,0.9717,1.0134,0.9219,0.9767,1.0258);
    b_vector<uint8_t> result = categorizer.categorizeSample(test_sample);
    Serial.print("Categorized sample: ");
    for(auto value : result) {
        Serial.print(value);
        Serial.print(" ");
    }
    categorizer.printInfo();

    manageSPIFFSFiles();

}

void loop() {

}